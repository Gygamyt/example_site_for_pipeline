{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block content %}

    <main>
        <div class="container wow fadeIn">
            <h2 class="my-5 h2 text-center">Checkout form</h2>
            <div class="row">
                <div class="col-md-8 mb-4">
                    <div class="card">
                        <form action="{% url 'checkout_url' %}" method="POST" class="card-body">
                            {% csrf_token %}

                            {% if not user.is_authenticated %}

                                <div class="md-form mb-5">
                                    {{ form.as_p.first_name }}
                                    <hr>
                                    {{ form.as_p.last_name }}
                                    <hr>
                                    {{ form.as_p.email }}
                                    <hr>
                                    {{ form.as_p.phone }}
                                    <hr>
                                    {{ form.as_p.commentary }}
                                    <hr>

                                </div>

                            {% endif %}

                            <h3>Delivery address</h3>

                            <div class='hideable_delivery_form'>
                                {{ form.address }}

                            </div>

                            {% if default_delivery_address %}
                                <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" name="use_default_address"
                                           id="use_default_address">
                                    <label class="custom-control-label" for="use_default_address">Use default delivery
                                        address: {{ default_delivery_address|truncatechars:10 }}</label>
                                </div>
                            {% endif %}

                            <hr>
                            <h3>Payment option</h3>

                            <div class="d-block my-3">
                                {% for value, name in form.fields.payment_option.choices %}
                                    <div class="custom-control custom-radio">
                                        <input id="{{ name }}" name="payment_option" value="{{ value }}" type="radio"
                                               class="custom-control-input" required>
                                        <label class="custom-control-label" for="{{ name }}">{{ name }}</label>
                                    </div>
                                {% endfor %}
                            </div>
                            <hr>
                            <h3>Delivery Time</h3>

                            <div class="md-form mb-5">
                                {{ form.delivery_time }}

                            </div>


                            <hr class="mb-4">
                            <button class="btn btn-primary btn-lg btn-block" type="submit">Continue to checkout</button>

                        </form>

                    </div>

                </div>

                <div class="col-md-4 mb-4">
                    {% include "order_snippet.html" %}
                </div>

            </div>

        </div>
    </main>

{% endblock content %}

{% block extra_scripts %}
    <script>
        var hideable_delivery_form = $('.hideable_delivery_form');

        var use_default_address = document.querySelector("input[name=use_default_address]");

        use_default_address.addEventListener('change', function () {
            if (this.checked) {
                hideable_delivery_form.hide();
            } else {
                hideable_delivery_form.show();
            }
        })

    </script>
{% endblock extra_scripts %}
